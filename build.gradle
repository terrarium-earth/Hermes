plugins {
    id "architectury-plugin" version "3.4-SNAPSHOT"
    id "dev.architectury.loom" version "1.1.+" apply false
}

architectury {
    minecraft = minecraft_version
}

allprojects {
    apply plugin: "java"
    apply plugin: "architectury-plugin"
    apply plugin: "maven-publish"

    archivesBaseName = rootProject.archives_base_name
    version = rootProject.mod_version
    group = rootProject.maven_group

    repositories {
        maven {
            url = "https://maven.resourcefulbees.com/repository/maven-public/"
        }
    }

    tasks.withType(JavaCompile) {
        options.encoding = "UTF-8"
        options.release = 17
    }

    java {
        withSourcesJar()
    }
}

subprojects {
    apply plugin: "dev.architectury.loom"

    loom {
        silentMojangMappingsLicense()
    }

    dependencies {
        minecraft "com.mojang:minecraft:${rootProject.minecraft_version}"
        mappings loom.officialMojangMappings()
    }

    var env = System.getenv()

    publishing {
        publications {
            mavenJava(MavenPublication) {
                artifactId = "$archives_base_name-$project.name-$minecraft_version"

                from components.java

                pom {
                    name = github_name
                    description = ''
                    url = "https://github.com/terrarium-earth/$github_name"

                    scm {
                        connection = "git:https://github.com/terrarium-earth/${github_name}.git"
                        developerConnection = "git:https://github.com/terrarium-earth/${github_name}.git"
                        url = "https://github.com/terrarium-earth/$github_name"
                    }

                    licenses {
                        license {
                            name = 'MIT'
                        }
                    }
                }
            }
        }
        repositories {
            mavenLocal()
            maven {
                url = "https://maven.resourcefulbees.com/repository/terrarium/"
                credentials {
                    username env.MAVEN_USER
                    password env.MAVEN_PASS
                }
            }
        }
    }
}
